# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.5.9'
    addToPath: true
    architecture: 'x64'

- script: pip install azure-storage-file-share
  displayName: 'Install azure-storage-file-share module'

- script: mkdir ./my_pandas
  displayName: 'create folder damn'
- task: PythonScript@0
  displayName: Show files and directories inside of File Share
  inputs:
    scriptSource: 'inline'
    script: |
      import time
      from azure.storage.fileshare import ShareFileClient
      connection_string = "DefaultEndpointsProtocol=https;AccountName=pomboblob;AccountKey='''KdTM0POw4s7Vnm+VUteO8nqe9qut95lhxcnjM8Goc/I0J9OsZyby+nJMI2kjuO5fbsdwkAqEkDgJzs4PDbX+TA==''';EndpointSuffix=core.windows.net"
      file_client = ShareFileClient.from_connection_string(conn_str=connection_string, share_name="pombofs", file_path ="pandas.py")
      with open("./my_pandas/pandas.py", "wb") as file_handle:
        data = file_client.download_file()
        data.readinto(file_handle)
      time.sleep(10)

- task: configuredatabricks@0
  inputs:
    url: 'https://adb-5113082355582282.2.azuredatabricks.net/'
    token: 'dapia94be3966645c88ce2a29b94555c8a89'


- task: deploynotebooks@0
  inputs:
    notebooksFolderPath: './my_pandas/'
    workspaceFolder: '/Shared'

- task: executenotebook@0
  inputs:
    notebookPath: '/Users/ropombo@microsoft.com/test'
    existingClusterId: '0217-142702-merit356'
    executionParams: '{\"X\":\"1\"}'

- script: |
    echo Add other tasks to build, test, and deploy your project.
    echo See https://aka.ms/yaml
  displayName: 'Run a multi-line script'
